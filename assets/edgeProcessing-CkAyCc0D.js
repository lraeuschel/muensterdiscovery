import{e as me}from"./deduplicate-8tH5LAE-.js";import{Q as F,t as Q}from"./InterleavedLayout-Hnid3ilX.js";import{t as ie}from"./VertexAttributeLocations-BfZbt_DV.js";import{dr as y,d6 as G,fz as we,fy as P,dS as Z,dA as J,dq as ee,dt as ae,dE as ce,fB as ve,fA as $e,cJ as le,dU as xe,cH as Ae}from"./index-D0COJ663.js";import{e as K}from"./Normals-tVeRIdmQ.js";const ye=F().vec3f("position").u16("componentIndex").freeze(),Ne=F().vec2u8("sideness").freeze(),fe=Q(Ne),ue=F().vec3f("position0").vec3f("position1").vec2i16("normalCompressed").u16("componentIndex").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).freeze(),de=F().vec3f("position0").vec3f("position1").vec2i16("normalCompressed").vec2i16("normal2Compressed").u16("componentIndex").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).freeze(),Ie=Q(ue,1),Se=Q(de,1);ie([fe,Ie]);ie([fe,Se]);class Ve{constructor(){this.position0=y(),this.position1=y(),this.faceNormal0=y(),this.faceNormal1=y(),this.componentIndex=0,this.cosAngle=0}}const O=-1;function be(e,n,o){const r=e.vertices.position,a=e.vertices.componentIndex,f=m.position0,p=m.position1,h=m.faceNormal0,$=m.faceNormal1,{edges:i,normals:u}=Me(e),w=i.length/4,x=n.allocate(w);let B=0;const k=w,N=o?.allocate(k);let L=0,t=0,s=0;W.length=0;for(let d=0;d<w;++d){const S=4*d;r.getVec(i.data[S],f),r.getVec(i.data[S+1],p);const M=W.pushNew();M.index=4*d,M.length=we(f,p)}W.sort((d,S)=>S.length-d.length);const l=new Array,c=new Array;W.forAll(({length:d,index:S})=>{const M=i.data[S],ge=i.data[S+1],T=i.data[S+2],X=i.data[S+3],Y=X===O;if(r.getVec(M,f),r.getVec(ge,p),Y){const A=3*T;P(h,u.data[A],u.data[A+1],u.data[A+2]),Z($,h),m.componentIndex=a.get(M),m.cosAngle=J(h,$)}else{let A=3*T;if(P(h,u.data[A],u.data[A+1],u.data[A+2]),A=3*X,P($,u.data[A],u.data[A+1],u.data[A+2]),m.componentIndex=a.get(M),m.cosAngle=J(h,$),Be(m,Ee))return;m.cosAngle<-.9999&&Z($,h)}t+=d,s++,Y||ze(m,ke)?(n.write(x,B++,m),l.push(d)):_e(m,pe)&&(N&&o&&o.write(N,L++,m),c.push(d))});const v=new Float32Array(l.reverse()),I=new Float32Array(c.reverse()),V=N&&o?{instancesData:N.slice(0,L),lodInfo:{lengths:I}}:void 0;return{regular:{instancesData:x.slice(0,B),lodInfo:{lengths:v}},silhouette:V,averageEdgeLength:t/s}}function ze(e,n){return e.cosAngle<n}function Be(e,n){return e.cosAngle>n}function _e(e,n){const o=ve(e.cosAngle);return $e(te,e.position1,e.position0),o*(J(ae(Ce,e.faceNormal0,e.faceNormal1),te)>0?-1:1)>n}function Me(e){const n=e.faces.length/3,o=e.faces,r=e.neighbors,a=e.vertices.position;g.length=j.length=0;for(let f=0;f<n;f++){const p=3*f,h=r[p],$=r[p+1],i=r[p+2],u=o[p],w=o[p+1],x=o[p+2];a.getVec(u,_),a.getVec(w,D),a.getVec(x,q),ee(D,D,_),ee(q,q,_),ae(_,D,q),ce(_,_),j.pushArray(_),(h===O||u<w)&&(g.push(u),g.push(w),g.push(f),g.push(h)),($===O||w<x)&&(g.push(w),g.push(x),g.push(f),g.push($)),(i===O||x<u)&&(g.push(x),g.push(u),g.push(f),g.push(i))}return{edges:g,normals:j}}class Ue{constructor(){this.index=0,this.length=0}}const W=new G({allocator:e=>e||new Ue,deallocator:null}),g=new G({deallocator:null}),j=new G({deallocator:null}),m=new Ve,Ce=y(),te=y(),_=y(),D=y(),q=y(),pe=le(4),Ee=Math.cos(pe),Fe=le(35),ke=Math.cos(Fe);function ne(e,n,o){const r=n/3,a=new Uint32Array(o+1),f=new Uint32Array(o+1),p=(t,s)=>{t<s?a[t+1]++:f[s+1]++};for(let t=0;t<r;t++){const s=e[3*t],l=e[3*t+1],c=e[3*t+2];p(s,l),p(l,c),p(c,s)}let h=0,$=0;for(let t=0;t<o;t++){const s=a[t+1],l=f[t+1];a[t+1]=h,f[t+1]=$,h+=s,$+=l}const i=new Uint32Array(6*r),u=a[o],w=(t,s,l)=>{if(t<s){const c=a[t+1]++;i[2*c]=s,i[2*c+1]=l}else{const c=f[s+1]++;i[2*u+2*c]=t,i[2*u+2*c+1]=l}};for(let t=0;t<r;t++){const s=e[3*t],l=e[3*t+1],c=e[3*t+2];w(s,l,t),w(l,c,t),w(c,s,t)}const x=(t,s)=>{const l=2*t,c=s-t;for(let v=1;v<c;v++){const I=i[l+2*v],V=i[l+2*v+1];let d=v-1;for(;d>=0&&i[l+2*d]>I;d--)i[l+2*d+2]=i[l+2*d],i[l+2*d+3]=i[l+2*d+1];i[l+2*d+2]=I,i[l+2*d+3]=V}};for(let t=0;t<o;t++)x(a[t],a[t+1]),x(u+f[t],u+f[t+1]);const B=new Int32Array(3*r),k=(t,s)=>t===e[3*s]?0:t===e[3*s+1]?1:t===e[3*s+2]?2:-1,N=(t,s)=>{const l=k(t,s);B[3*s+l]=-1},L=(t,s,l,c)=>{const v=k(t,s);B[3*s+v]=c;const I=k(l,c);B[3*c+I]=s};for(let t=0;t<o;t++){let s=a[t];const l=a[t+1];let c=f[t];const v=f[t+1];for(;s<l&&c<v;){const I=i[2*s],V=i[2*u+2*c];I===V?(L(t,i[2*s+1],V,i[2*u+2*c+1]),s++,c++):I<V?(N(t,i[2*s+1]),s++):(N(V,i[2*u+2*c+1]),c++)}for(;s<l;)N(t,i[2*s+1]),s++;for(;c<v;)N(i[2*u+2*c],i[2*u+2*c+1]),c++}return B}const R=.7;let he=class{updateSettings(n){this.settings=n,this._edgeHashFunction=n.reducedPrecision?We:Le}write(n,o,r){H.seed=this._edgeHashFunction(r);const a=H.getIntRange(0,255),f=H.getIntRange(0,this.settings.variants-1),p=H.getFloat(),h=255*(.5*De(-(1-Math.min(p/R,1))+Math.max(0,p-R)/(1-R),1.2)+.5);n.position0.setVec(o,r.position0),n.position1.setVec(o,r.position1),n.componentIndex.set(o,r.componentIndex),n.variantOffset.set(o,a),n.variantStroke.set(o,f),n.variantExtension.set(o,h)}};const b=new Float32Array(6),z=new Uint32Array(b.buffer),E=new Uint32Array(1);function Le(e){return b[0]=e.position0[0],b[1]=e.position0[1],b[2]=e.position0[2],b[3]=e.position1[0],b[4]=e.position1[1],b[5]=e.position1[2],E[0]=31*(31*(31*(31*(31*(166811+z[0])+z[1])+z[2])+z[3])+z[4])+z[5],E[0]}function We(e){const n=b;n[0]=U(e.position0[0]),n[1]=U(e.position0[1]),n[2]=U(e.position0[2]),n[3]=U(e.position1[0]),n[4]=U(e.position1[1]),n[5]=U(e.position1[2]),E[0]=5381;for(let o=0;o<z.length;o++)E[0]=31*E[0]+z[o];return E[0]}const oe=1e4;function U(e){return Math.round(e*oe)/oe}function De(e,n){return Math.abs(e)**n*Math.sign(e)}class qe{constructor(){this._commonWriter=new he}updateSettings(n){this._commonWriter.updateSettings(n)}allocate(n){return ue.createBuffer(n)}write(n,o,r){this._commonWriter.write(n,o,r),xe(C,r.faceNormal0,r.faceNormal1),ce(C,C);const{typedBuffer:a,typedBufferStride:f}=n.normalCompressed;K(a,o,C[0],C[1],C[2],f)}}class He{constructor(){this._commonWriter=new he}updateSettings(n){this._commonWriter.updateSettings(n)}allocate(n){return de.createBuffer(n)}write(n,o,r){this._commonWriter.write(n,o,r);{const{typedBuffer:a,typedBufferStride:f}=n.normalCompressed;K(a,o,r.faceNormal0[0],r.faceNormal0[1],r.faceNormal0[2],f)}{const{typedBuffer:a,typedBufferStride:f}=n.normal2Compressed;K(a,o,r.faceNormal1[0],r.faceNormal1[1],r.faceNormal1[2],f)}}}const C=y(),H=new Ae;function Te(e){const n=Oe(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return se.updateSettings(e.writerSettings),re.updateSettings(e.writerSettings),be(n,se,re)}function Oe(e,n,o,r){if(n){const p=ne(o,r,e.count);return new Pe(o,r,p,e)}const a=me(e.buffer,e.stride/4,{originalIndices:o}),f=ne(a.indices,r,a.uniqueCount);return{faces:a.indices,facesLength:a.indices.length,neighbors:f,vertices:ye.createView(a.buffer)}}class Pe{constructor(n,o,r,a){this.faces=n,this.facesLength=o,this.neighbors=r,this.vertices=a}}const se=new qe,re=new He,Xe=F().vec3f("position0").vec3f("position1"),Ye=F().vec3f("position0").vec3f("position1").u16("componentIndex");export{Xe as a,Te as c,be as d,Oe as f,Ye as g,ye as t};
